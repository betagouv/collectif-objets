- content_for(:head_title) { "Connexion recenseur" }

%main#contenu.fr-container.fr-pt-2w.fr-pb-4w{"data-controller": "devise--sessions"}
  - if @recenseur&.session_code
    .fr-alert.fr-alert--info.fr-mb-2w
      Le code de connexion a été envoyé à #{@recenseur.email}

  = render "shared/breadcrumbs", links: [ ["Accueil", root_path]], current_page_label: "Connexion recenseur"

  .fr-grid-row
    .fr-col-md-5
      %h1.fr-h2 Connexion en tant que recenseur

      = form_with(url: recenseur_session_path, builder: FormBuilderDsfr, data: { turbo_frame: "_top" }) do |f|
        = f.hidden_field :email, value: @recenseur.email
        .fr-input-group{class: ("fr-input-group--error" if @errors.key?(:email))}
          = f.label :email
          = f.text_field :email,
            value: params[:email],
            required: true,
            autocomplete: :email,
            autofocus: @recenseur.email.empty?,
            class: ("fr-input--error" if @errors.key?(:email)),
            **(@error ? { aria: { describedby: :error_email } }  : {})
          - if @errors.key?(:email)
            %p#error_email.fr-error-text.fr-text--md
              = @errors.full_messages_for(:email).to_sentence
        .fr-input-group{class: ("fr-input-group--error" if @errors.key?(:code))}
          = f.label :code, "Code de connexion (6 chiffres)"
          = f.text_field :code,
            value: params[:code],
            required: true,
            autofocus: @recenseur.email.present?,
            inputmode: :numeric,
            autocomplete: "one-time-code",
            class: ("fr-input--error" if @errors.key?(:code)),
            **(@error ? { aria: { describedby: :error_code } }  : {})
          - if @errors.key?(:code)
            %p#error_code.fr-error-text.fr-text--md
              = @errors.full_messages_for(:code).to_sentence
        .fr-input-group.fr-btns-group
          = f.button "Connexion", type: :submit, name: nil
          = link_to "Demander un nouveau code de connexion",
            new_recenseur_session_code_path(email: @recenseur.email),
            class: "fr-btn fr-btn--tertiary"

      .fr-mt-10w
        = render "recenseurs/sessions/faq"

    = render "recenseurs/sessions/right_column"
