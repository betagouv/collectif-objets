- content_for(:head_title) { "Gérer l'authentification 2FA" }

%main#contenu.fr-container.fr-pt-2w.fr-pb-4w
  = render("shared/breadcrumbs", links: [["Administration", admin_path], ["Admins", admin_admin_users_path], [current_admin_user.to_s, admin_admin_user_path(current_admin_user)]], current_page_label: "Gérer la 2FA")

  %h1 Authentification à deux facteurs

  .fr-grid-row
    .fr-col-md-8
      .fr-alert.fr-alert--success.fr-mb-4w
        %p.fr-alert__title Authentification 2FA activée
        %p Votre compte est protégé par l'authentification à deux facteurs.

      - if @admin_user.otp_backup_codes_remaining.positive?
        .fr-callout.fr-mb-4w
          %h3.fr-callout__title Codes de secours
          %p
            Il vous reste
            %strong
              = pluralize(@admin_user.otp_backup_codes_remaining, "code")
              de secours
            pour vous connecter si vous n'avez pas accès à votre application d'authentification.
      - else
        .fr-alert.fr-alert--warning.fr-mb-4w
          %p.fr-alert__title Aucun code de secours disponible
          %p
            Vous n'avez plus de codes de secours. Pour en générer de nouveaux, vous devez
            désactiver puis réactiver l'authentification à 2 facteurs ci-dessous.

      %h2.fr-h5.fr-mt-4w Désactiver l'authentification à 2 facteurs

      .fr-alert.fr-alert--warning.fr-mb-4w
        %p.fr-alert__title Attention
        %p
          La désactivation de la 2FA supprimera tous vos codes de secours actuels.
          Si vous réactivez la 2FA, de nouveaux codes de secours seront générés
          et les anciens ne fonctionneront plus.

      = form_with url: disable_admin_admin_user_two_factor_settings_path(@admin_user), method: :post do |f|
        .fr-input-group
          = render PasswordInputComponent.new(name: "password", autocomplete: "current-password", hint: false)
        .fr-input-group
          = f.label :otp_attempt, "Code 2FA"
          = f.text_field :otp_attempt, class: "fr-input", required: true, autocomplete: "one-time-code", placeholder: "123456"
        .fr-mt-2w
          = f.submit "Désactiver 2FA", class: "fr-btn", data: { confirm: "Êtes-vous sûr de vouloir désactiver l'authentification 2FA ? Tous vos codes de secours seront supprimés." }
